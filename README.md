# gce-task-runner

## 概要

社内でよくある次のようなシーンで使えるライブラリです

* GCEインスタンスを起動して、何か処理をさせたい
* 複数インスタンスの分散処理で全インスタンスの処理が終わってから次の処理をさせたい
* タスクごとにスペックやGPUの有無を変えたい

行なっていることは主に次の2点です。

* タスクの実行を管理するマネージャー
  * 起動スクリプトで指定し、ランナーにあたるインスタンスを起動する
  * ランナーからの`gce_task_runner.notify_completion()`をキャッチしてインスタンスを削除する
  * そのタスクのインスタンスが全て削除されたら、次のタスクに移動して繰り返す

* タスクの実行を行うランナー
  * 起動スクリプトに行いたい処理を書く
  * 処理が終わったら`gce_task_runner.notify_completion()`を呼び出す

## 使い方

### マネージャー

[sample_manager.py](./sample_manager.py)を確認してください。

### ランナー

`gce_task_runner.notify_completion()`を呼び出せばOKです。
が、そのためにはこのライブラリをインストールしておく必要があります。
なのであらかじめDockerイメージを作って置いて、起動スクリプトではそれを実行するだけにしておくと楽です。

